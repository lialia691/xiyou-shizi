<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App.js é‡æ„æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .module-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .module-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .module-methods {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">ğŸ”§ App.js æ¨¡å—åŒ–é‡æ„æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>æ¨¡å—ç»“æ„éªŒè¯</h3>
            <button onclick="testModuleStructure()">æ£€æŸ¥æ¨¡å—ç»“æ„</button>
            <div id="module-results"></div>
        </div>

        <div class="test-section">
            <h3>æ¸¸æˆçŠ¶æ€ç®¡ç†æµ‹è¯•</h3>
            <button onclick="testGameState()">æµ‹è¯•GameStateæ¨¡å—</button>
            <div id="gamestate-results"></div>
        </div>

        <div class="test-section">
            <h3>UIæ¨¡å—æµ‹è¯•</h3>
            <button onclick="testUIModule()">æµ‹è¯•UIæ¨¡å—</button>
            <div id="ui-results"></div>
        </div>

        <div class="test-section">
            <h3>æ¸¸æˆé€»è¾‘æµ‹è¯•</h3>
            <button onclick="testGameLogic()">æµ‹è¯•GameLogicæ¨¡å—</button>
            <div id="gamelogic-results"></div>
        </div>

        <div class="test-section">
            <h3>äº‹ä»¶å¤„ç†æµ‹è¯•</h3>
            <button onclick="testEventHandler()">æµ‹è¯•EventHandleræ¨¡å—</button>
            <div id="eventhandler-results"></div>
        </div>

        <div class="test-section">
            <h3>å®Œæ•´åŠŸèƒ½æµ‹è¯•</h3>
            <button onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="full-results"></div>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿå¿…è¦çš„HTMLç»“æ„ -->
    <div style="display: none;">
        <div id="route-map-view"></div>
        <div id="game-view"></div>
        <div id="level-nodes-container"></div>
        <div id="fail-modal"></div>
        <div id="level-complete-modal"></div>
        <button id="continue-btn"></button>
        <button id="retry-btn"></button>
        <div id="lives-tracker"></div>
        <div id="score-tracker"></div>
        <div id="progress-tracker"></div>
        <div id="scene-title"></div>
        <img id="scene-image">
        <div id="character-display"></div>
        <div id="character-text"></div>
        <div class="options-container">
            <button class="option-btn"></button>
            <button class="option-btn"></button>
            <button class="option-btn"></button>
            <button class="option-btn"></button>
        </div>
        <div id="feedback-message"></div>
        <div id="modal-title"></div>
        <div id="modal-message"></div>
        <div id="puti-advice"></div>
        <div id="puti-recommendation"></div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„ä¾èµ– -->
    <script>
        // æ¨¡æ‹Ÿå¿…è¦çš„å…¨å±€å˜é‡å’Œå‡½æ•°
        window.gameData = [
            {
                scene: "æµ‹è¯•å…³å¡",
                image: "test.jpg",
                characters: [
                    { char: "ä¸€", pinyin: "yÄ«" },
                    { char: "äºŒ", pinyin: "Ã¨r" }
                ],
                item: { name: "æµ‹è¯•é“å…·", icon: "ğŸ¯" }
            }
        ];

        window.speechSystem = {
            isPlaying: false,
            speakPinyin: async (pinyin) => {
                console.log(`æ¨¡æ‹Ÿæ’­æ”¾æ‹¼éŸ³: ${pinyin}`);
                return Promise.resolve();
            }
        };

        window.initSpeechSystem = async () => Promise.resolve();
        window.initializeDataSystem = async () => Promise.resolve();
        window.getGameData = () => window.gameData;
        window.getPutiAdvice = () => [{ icon: "ğŸ§˜â€â™‚ï¸", message: "æµ‹è¯•å»ºè®®" }];
        window.getPutiRecommendation = () => ({ type: "learning", reason: "æµ‹è¯•æ¨è", estimatedTime: 5 });
        window.recordLearningResult = () => {};
    </script>

    <!-- å¼•å…¥é‡æ„åçš„app.js -->
    <script src="app.js"></script>

    <script>
        // å·¥å…·å‡½æ•°
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        // æµ‹è¯•æ¨¡å—ç»“æ„
        function testModuleStructure() {
            clearResults('module-results');
            
            const modules = [
                { name: 'Utils', obj: window.Utils },
                { name: 'GameState', obj: window.GameState },
                { name: 'UI', obj: window.UI },
                { name: 'GameLogic', obj: window.GameLogic },
                { name: 'EventHandler', obj: window.EventHandler },
                { name: 'PutiSystem', obj: window.PutiSystem },
                { name: 'App', obj: window.App }
            ];

            modules.forEach(module => {
                if (module.obj) {
                    const methods = Object.getOwnPropertyNames(module.obj).filter(prop => 
                        typeof module.obj[prop] === 'function'
                    );
                    logResult('module-results', 
                        `<div class="module-info">
                            <div class="module-name">âœ… ${module.name} æ¨¡å—</div>
                            <div class="module-methods">æ–¹æ³•: ${methods.join(', ')}</div>
                        </div>`, 'success');
                } else {
                    logResult('module-results', `âŒ ${module.name} æ¨¡å—æœªæ‰¾åˆ°`, 'error');
                }
            });
        }

        // æµ‹è¯•GameStateæ¨¡å—
        function testGameState() {
            clearResults('gamestate-results');
            
            try {
                // æµ‹è¯•é‡ç½®åŠŸèƒ½
                GameState.reset();
                logResult('gamestate-results', 'âœ… GameState.reset() æ‰§è¡ŒæˆåŠŸ', 'success');
                
                // æµ‹è¯•çŠ¶æ€æ›´æ–°
                GameState.increaseScore();
                logResult('gamestate-results', `âœ… åˆ†æ•°å¢åŠ : ${GameState.score}`, 'success');
                
                GameState.decreaseLife();
                logResult('gamestate-results', `âœ… ç”Ÿå‘½å‡å°‘: ${GameState.lives}`, 'success');
                
                // æµ‹è¯•å…³å¡åˆå§‹åŒ–
                GameState.initializeLevel(1);
                logResult('gamestate-results', `âœ… å…³å¡åˆå§‹åŒ–: Level ${GameState.currentLevelIndex}, Lives ${GameState.lives}`, 'success');
                
            } catch (error) {
                logResult('gamestate-results', `âŒ GameStateæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•UIæ¨¡å—
        function testUIModule() {
            clearResults('ui-results');
            
            try {
                // æµ‹è¯•UIæ›´æ–°æ–¹æ³•
                GameState.lives = 3;
                GameState.score = 100;
                
                UI.updateLivesDisplay();
                UI.updateScoreDisplay();
                
                logResult('ui-results', 'âœ… UIæ˜¾ç¤ºæ›´æ–°æˆåŠŸ', 'success');
                logResult('ui-results', `âœ… ç”Ÿå‘½æ˜¾ç¤º: ${UI.livesTrackerEl.textContent}`, 'info');
                logResult('ui-results', `âœ… åˆ†æ•°æ˜¾ç¤º: ${UI.scoreTrackerEl.textContent}`, 'info');
                
                // æµ‹è¯•åé¦ˆæ¶ˆæ¯
                UI.updateFeedbackMessage('æµ‹è¯•æ¶ˆæ¯', 'green');
                logResult('ui-results', 'âœ… åé¦ˆæ¶ˆæ¯æ›´æ–°æˆåŠŸ', 'success');
                
            } catch (error) {
                logResult('ui-results', `âŒ UIæ¨¡å—æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•GameLogicæ¨¡å—
        function testGameLogic() {
            clearResults('gamelogic-results');
            
            try {
                // æµ‹è¯•é¢˜ç›®åŠ è½½
                GameState.initializeLevel(0);
                GameLogic.loadQuestion();
                logResult('gamelogic-results', 'âœ… é¢˜ç›®åŠ è½½æˆåŠŸ', 'success');
                
                // æµ‹è¯•æ‹¼éŸ³æ’­æ”¾
                GameLogic.playPinyinOnly('yÄ«').then(() => {
                    logResult('gamelogic-results', 'âœ… æ‹¼éŸ³æ’­æ”¾åŠŸèƒ½æ­£å¸¸', 'success');
                });
                
                logResult('gamelogic-results', `âœ… å½“å‰æ±‰å­—: ${UI.characterTextEl.textContent}`, 'info');
                logResult('gamelogic-results', `âœ… æ­£ç¡®æ‹¼éŸ³: ${GameState.correctPinyin}`, 'info');
                
            } catch (error) {
                logResult('gamelogic-results', `âŒ GameLogicæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•EventHandleræ¨¡å—
        function testEventHandler() {
            clearResults('eventhandler-results');
            
            try {
                // æµ‹è¯•äº‹ä»¶å¤„ç†å™¨åˆå§‹åŒ–
                EventHandler.init();
                logResult('eventhandler-results', 'âœ… äº‹ä»¶å¤„ç†å™¨åˆå§‹åŒ–æˆåŠŸ', 'success');
                
                // æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶
                const mockEvent = {
                    target: UI.optionButtons[0],
                    preventDefault: () => {},
                    stopPropagation: () => {}
                };
                
                // è®¾ç½®æµ‹è¯•æ•°æ®
                UI.optionButtons[0].dataset.pinyin = 'yÄ«';
                
                logResult('eventhandler-results', 'âœ… äº‹ä»¶å§”æ‰˜è®¾ç½®å®Œæˆ', 'success');
                logResult('eventhandler-results', 'âœ… æ¨¡æ‹Ÿäº‹ä»¶æµ‹è¯•å‡†å¤‡å°±ç»ª', 'info');
                
            } catch (error) {
                logResult('eventhandler-results', `âŒ EventHandleræµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // è¿è¡Œå®Œæ•´æµ‹è¯•
        async function runFullTest() {
            clearResults('full-results');
            logResult('full-results', 'ğŸš€ å¼€å§‹å®Œæ•´åŠŸèƒ½æµ‹è¯•...', 'info');
            
            try {
                // æµ‹è¯•åº”ç”¨åˆå§‹åŒ–
                await App.init();
                logResult('full-results', 'âœ… åº”ç”¨åˆå§‹åŒ–æˆåŠŸ', 'success');
                
                // æµ‹è¯•æ¸¸æˆæµç¨‹
                GameLogic.startLevel(0);
                logResult('full-results', 'âœ… æ¸¸æˆå…³å¡å¯åŠ¨æˆåŠŸ', 'success');
                
                // æµ‹è¯•AIè©æç³»ç»Ÿ
                PutiSystem.updatePanel();
                logResult('full-results', 'âœ… AIè©æé¢æ¿æ›´æ–°æˆåŠŸ', 'success');
                
                // æµ‹è¯•çŠ¶æ€ä¿å­˜
                GameState.saveProgress();
                logResult('full-results', 'âœ… è¿›åº¦ä¿å­˜æˆåŠŸ', 'success');
                
                logResult('full-results', 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é‡æ„æˆåŠŸï¼', 'success');
                
            } catch (error) {
                logResult('full-results', `âŒ å®Œæ•´æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥æ¨¡å—ç»“æ„
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('ğŸ”§ App.js é‡æ„æµ‹è¯•é¡µé¢å·²åŠ è½½');
                testModuleStructure();
            }, 1000);
        });
    </script>
</body>
</html>
