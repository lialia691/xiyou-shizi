<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIè©æç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">ğŸ§˜â€â™‚ï¸ AIè©ææ™ºèƒ½å­¦ä¹ ç³»ç»Ÿæµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ç³»ç»Ÿåˆå§‹åŒ–æµ‹è¯•</h3>
            <button onclick="testSystemInitialization()">æµ‹è¯•ç³»ç»Ÿåˆå§‹åŒ–</button>
            <div id="init-results"></div>
        </div>

        <div class="test-section">
            <h3>æ•°æ®ç®¡ç†æµ‹è¯•</h3>
            <button onclick="testDataManagement()">æµ‹è¯•æ•°æ®ç®¡ç†</button>
            <div id="data-results"></div>
        </div>

        <div class="test-section">
            <h3>å­¦ä¹ æ¨èæµ‹è¯•</h3>
            <button onclick="testLearningRecommendation()">æµ‹è¯•å­¦ä¹ æ¨è</button>
            <div id="recommendation-results"></div>
        </div>

        <div class="test-section">
            <h3>å­¦ä¹ è®°å½•æµ‹è¯•</h3>
            <button onclick="testLearningRecord()">æµ‹è¯•å­¦ä¹ è®°å½•</button>
            <div id="record-results"></div>
        </div>

        <div class="test-section">
            <h3>å¤ä¹ è°ƒåº¦æµ‹è¯•</h3>
            <button onclick="testReviewScheduling()">æµ‹è¯•å¤ä¹ è°ƒåº¦</button>
            <div id="review-results"></div>
        </div>

        <div class="test-section">
            <h3>ç³»ç»ŸçŠ¶æ€</h3>
            <button onclick="showSystemStatus()">æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€</button>
            <div id="status-results"></div>
        </div>

        <div class="test-section">
            <h3>å®Œæ•´æµ‹è¯•</h3>
            <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <div id="all-results"></div>
        </div>
    </div>

    <!-- å¼•å…¥æ‰€æœ‰æ¨¡å— -->
    <script src="ai-puti-system.js"></script>
    <script src="user-data-manager.js"></script>
    <script src="character-provider.js"></script>
    <script src="review-scheduler.js"></script>

    <script>
        let aiPutiSystem = null;

        // å·¥å…·å‡½æ•°
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        // æµ‹è¯•ç³»ç»Ÿåˆå§‹åŒ–
        async function testSystemInitialization() {
            clearResults('init-results');
            
            try {
                logResult('init-results', 'ğŸ”„ å¼€å§‹åˆå§‹åŒ–AIè©æç³»ç»Ÿ...', 'info');
                
                aiPutiSystem = new AIPutiSystem();
                const success = await aiPutiSystem.initialize();
                
                if (success) {
                    logResult('init-results', 'âœ… ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸï¼', 'success');
                    
                    const status = aiPutiSystem.getSystemStatus();
                    logResult('init-results', `ğŸ“Š ç³»ç»ŸçŠ¶æ€: ${JSON.stringify(status, null, 2)}`, 'info');
                } else {
                    logResult('init-results', 'âŒ ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥', 'error');
                }
            } catch (error) {
                logResult('init-results', `âŒ åˆå§‹åŒ–é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ•°æ®ç®¡ç†
        async function testDataManagement() {
            clearResults('data-results');
            
            if (!aiPutiSystem) {
                logResult('data-results', 'âš ï¸ è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            try {
                logResult('data-results', 'ğŸ”„ æµ‹è¯•æ•°æ®ç®¡ç†åŠŸèƒ½...', 'info');
                
                // æµ‹è¯•ä¿å­˜æ•°æ®
                const saveSuccess = await aiPutiSystem.saveUserData();
                logResult('data-results', `ğŸ’¾ æ•°æ®ä¿å­˜: ${saveSuccess ? 'æˆåŠŸ' : 'å¤±è´¥'}`, 
                    saveSuccess ? 'success' : 'error');
                
                // æµ‹è¯•å¯¼å‡ºæ•°æ®
                const exportData = await aiPutiSystem.exportUserData();
                if (exportData) {
                    logResult('data-results', 'ğŸ“¤ æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
                    logResult('data-results', `ğŸ“Š å¯¼å‡ºæ•°æ®å¤§å°: ${JSON.stringify(exportData).length} å­—ç¬¦`, 'info');
                } else {
                    logResult('data-results', 'âŒ æ•°æ®å¯¼å‡ºå¤±è´¥', 'error');
                }
                
            } catch (error) {
                logResult('data-results', `âŒ æ•°æ®ç®¡ç†é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•å­¦ä¹ æ¨è
        async function testLearningRecommendation() {
            clearResults('recommendation-results');
            
            if (!aiPutiSystem) {
                logResult('recommendation-results', 'âš ï¸ è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            try {
                logResult('recommendation-results', 'ğŸ”„ æµ‹è¯•å­¦ä¹ æ¨èåŠŸèƒ½...', 'info');
                
                const recommendation = await aiPutiSystem.recommendNextLearning();
                logResult('recommendation-results', 'âœ… è·å–å­¦ä¹ æ¨èæˆåŠŸ', 'success');
                logResult('recommendation-results', 
                    `ğŸ“š æ¨èç±»å‹: ${recommendation.type}<br>
                     ğŸ“ æ¨èç†ç”±: ${recommendation.reason}<br>
                     â±ï¸ é¢„è®¡æ—¶é—´: ${recommendation.estimatedTime} åˆ†é’Ÿ<br>
                     ğŸ“Š æ±‰å­—æ•°é‡: ${recommendation.characters.length}`, 'info');
                
                if (recommendation.characters.length > 0) {
                    const chars = recommendation.characters.slice(0, 5).map(c => c.char || c.charId).join(', ');
                    logResult('recommendation-results', `ğŸ”¤ æ¨èæ±‰å­—: ${chars}`, 'info');
                }
                
            } catch (error) {
                logResult('recommendation-results', `âŒ æ¨èåŠŸèƒ½é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•å­¦ä¹ è®°å½•
        async function testLearningRecord() {
            clearResults('record-results');
            
            if (!aiPutiSystem) {
                logResult('record-results', 'âš ï¸ è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            try {
                logResult('record-results', 'ğŸ”„ æµ‹è¯•å­¦ä¹ è®°å½•åŠŸèƒ½...', 'info');
                
                // æ¨¡æ‹Ÿå­¦ä¹ å‡ ä¸ªæ±‰å­—
                const testChars = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”'];
                
                for (let i = 0; i < testChars.length; i++) {
                    const char = testChars[i];
                    const isCorrect = Math.random() > 0.3; // 70% æ­£ç¡®ç‡
                    const timeSpent = Math.random() * 5000 + 1000; // 1-6ç§’
                    
                    const result = await aiPutiSystem.recordLearningResult(char, isCorrect, timeSpent);
                    logResult('record-results', 
                        `ğŸ“ è®°å½• "${char}": ${isCorrect ? 'âœ…' : 'âŒ'} (${Math.round(timeSpent)}ms)`, 
                        isCorrect ? 'success' : 'error');
                }
                
                // æ˜¾ç¤ºå­¦ä¹ ç»Ÿè®¡
                const stats = aiPutiSystem.getUserLearningStats();
                logResult('record-results', 
                    `ğŸ“Š å­¦ä¹ ç»Ÿè®¡:<br>
                     - æ€»æ±‰å­—æ•°: ${stats.totalCharacters}<br>
                     - æŒæ¡æ±‰å­—: ${stats.uniqueCharsLearned}<br>
                     - å¹³å‡æ­£ç¡®ç‡: ${(stats.averageCorrectRate * 100).toFixed(1)}%<br>
                     - å¹³å‡å“åº”æ—¶é—´: ${Math.round(stats.averageResponseTime)}ms`, 'info');
                
            } catch (error) {
                logResult('record-results', `âŒ å­¦ä¹ è®°å½•é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•å¤ä¹ è°ƒåº¦
        async function testReviewScheduling() {
            clearResults('review-results');
            
            if (!aiPutiSystem) {
                logResult('review-results', 'âš ï¸ è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            try {
                logResult('review-results', 'ğŸ”„ æµ‹è¯•å¤ä¹ è°ƒåº¦åŠŸèƒ½...', 'info');
                
                const reviewNeeded = aiPutiSystem.getCharactersNeedingReview();
                logResult('review-results', `ğŸ“š éœ€è¦å¤ä¹ çš„æ±‰å­—æ•°é‡: ${reviewNeeded.length}`, 'info');
                
                if (reviewNeeded.length > 0) {
                    const topReview = reviewNeeded.slice(0, 3);
                    topReview.forEach(item => {
                        logResult('review-results', 
                            `ğŸ”¤ "${item.charId}" - ä¼˜å…ˆçº§: ${item.priority.toFixed(2)}, æ­£ç¡®ç‡: ${(item.correctRate * 100).toFixed(1)}%`, 
                            'info');
                    });
                } else {
                    logResult('review-results', 'ğŸ‰ æš‚æ— éœ€è¦å¤ä¹ çš„æ±‰å­—', 'success');
                }
                
                // æµ‹è¯•AIå»ºè®®
                const advice = aiPutiSystem.generatePutiAdvice();
                if (advice.length > 0) {
                    logResult('review-results', 'ğŸ’¡ AIè©æå»ºè®®:', 'info');
                    advice.forEach(item => {
                        logResult('review-results', `${item.icon} ${item.message}`, 'info');
                    });
                } else {
                    logResult('review-results', 'ğŸ˜Œ æš‚æ— ç‰¹åˆ«å»ºè®®', 'success');
                }
                
            } catch (error) {
                logResult('review-results', `âŒ å¤ä¹ è°ƒåº¦é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€
        async function showSystemStatus() {
            clearResults('status-results');
            
            if (!aiPutiSystem) {
                logResult('status-results', 'âš ï¸ ç³»ç»Ÿæœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                const status = aiPutiSystem.getSystemStatus();
                const stats = aiPutiSystem.getUserLearningStats();
                
                logResult('status-results', 
                    `<div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${status.isInitialized ? 'âœ…' : 'âŒ'}</div>
                            <div class="stat-label">ç³»ç»ŸçŠ¶æ€</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${status.totalCharacters}</div>
                            <div class="stat-label">å­¦ä¹ æ±‰å­—æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.uniqueCharsLearned}</div>
                            <div class="stat-label">æŒæ¡æ±‰å­—æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${(stats.averageCorrectRate * 100).toFixed(1)}%</div>
                            <div class="stat-label">å¹³å‡æ­£ç¡®ç‡</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${status.consecutiveDays}</div>
                            <div class="stat-label">è¿ç»­å­¦ä¹ å¤©æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Math.round(stats.totalStudyTime / 1000)}s</div>
                            <div class="stat-label">æ€»å­¦ä¹ æ—¶é—´</div>
                        </div>
                    </div>`, 'info');
                
            } catch (error) {
                logResult('status-results', `âŒ çŠ¶æ€è·å–é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            clearResults('all-results');
            logResult('all-results', 'ğŸš€ å¼€å§‹è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶...', 'info');
            
            try {
                await testSystemInitialization();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testDataManagement();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testLearningRecommendation();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testLearningRecord();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testReviewScheduling();
                
                logResult('all-results', 'ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼', 'success');
                
            } catch (error) {
                logResult('all-results', `âŒ æµ‹è¯•å¥—ä»¶é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œåˆå§‹åŒ–æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('ğŸ§˜â€â™‚ï¸ AIè©æç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>
