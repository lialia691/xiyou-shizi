<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆé€‰é¡¹å‘éŸ³æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        h1 {
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .character-display {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .character-text {
            font-size: 4em;
            font-weight: bold;
            color: #fff;
            margin-bottom: 10px;
        }
        
        .character-info {
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 30px 0;
        }
        
        .option-btn {
            padding: 20px 15px;
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
            background-color: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 60px;
        }
        
        .option-btn:hover:enabled {
            background-color: #f0f8ff;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .option-btn.playing {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            animation: optionPulse 0.6s ease-in-out;
        }
        
        .option-btn.correct-option {
            background: #4CAF50;
            color: white;
            border-color: #45a049;
        }
        
        .option-btn.wrong-option {
            background: #f44336;
            color: white;
            border-color: #da190b;
        }
        
        @keyframes optionPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .feedback {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            font-size: 1.1em;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .status {
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 0.9em;
        }
        
        .test-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9em;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® æ¸¸æˆé€‰é¡¹å‘éŸ³æµ‹è¯•</h1>
        
        <div class="test-info">
            <strong>æµ‹è¯•ç›®æ ‡ï¼š</strong>éªŒè¯æ‰€æœ‰æ‹¼éŸ³é€‰é¡¹ï¼ˆåŒ…æ‹¬é”™è¯¯é€‰é¡¹ï¼‰éƒ½èƒ½æ­£ç¡®å‘éŸ³<br>
            <strong>æµ‹è¯•æ–¹æ³•ï¼š</strong>ç‚¹å‡»ä»»æ„æ‹¼éŸ³é€‰é¡¹ï¼Œå¬å‘éŸ³æ˜¯å¦æ­£ç¡®
        </div>
        
        <div class="status" id="status">ç‚¹å‡»"åˆå§‹åŒ–"å¼€å§‹æµ‹è¯•</div>
        
        <div class="controls">
            <button class="control-btn" onclick="initTest()">ğŸ”„ åˆå§‹åŒ–è¯­éŸ³</button>
            <button class="control-btn" onclick="nextQuestion()">â¡ï¸ ä¸‹ä¸€é¢˜</button>
            <button class="control-btn" onclick="testAllOptions()">ğŸµ æµ‹è¯•å…¨éƒ¨é€‰é¡¹</button>
        </div>
        
        <div class="character-display">
            <div class="character-text" id="character-text">çš„</div>
            <div class="character-info" id="character-info">ç‚¹å‡»ä¸‹é¢çš„æ‹¼éŸ³é€‰é¡¹å¬å‘éŸ³</div>
        </div>
        
        <div class="feedback" id="feedback">æ‰€æœ‰é€‰é¡¹éƒ½åº”è¯¥èƒ½æ­£ç¡®å‘éŸ³</div>
        
        <div class="quiz-options" id="quiz-options">
            <button class="option-btn" data-pinyin="de">de</button>
            <button class="option-btn" data-pinyin="lÃ¡i">lÃ¡i</button>
            <button class="option-btn" data-pinyin="zÃ i">zÃ i</button>
            <button class="option-btn" data-pinyin="tÄ">tÄ</button>
        </div>
    </div>

    <script src="speech-system.js"></script>
    <script>
        let speechSystem = null;
        let currentChar = { char: 'çš„', pinyin: 'de' };
        let correctPinyin = 'de';
        let currentIndex = 0;
        
        const testQuestions = [
            {
                char: 'çš„', 
                pinyin: 'de',
                options: ['de', 'lÃ¡i', 'zÃ i', 'tÄ']
            },
            {
                char: 'ä¸€', 
                pinyin: 'yÄ«',
                options: ['yÄ«', 'shÃ¬', 'wÇ’', 'nÇ']
            },
            {
                char: 'æ˜¯', 
                pinyin: 'shÃ¬',
                options: ['shÃ¬', 'hÇo', 'xuÃ©', 'zÃ¬']
            },
            {
                char: 'äº†', 
                pinyin: 'le',
                options: ['le', 'mÄ', 'mÃ¡', 'mÇ']
            },
            {
                char: 'æˆ‘', 
                pinyin: 'wÇ’',
                options: ['wÇ’', 'dÃ o', 'shÃ­', 'dÃ ']
            },
            {
                char: 'ä½ ', 
                pinyin: 'nÇ',
                options: ['nÇ', 'wÃ©i', 'zhÅng', 'shuÅ']
            },
            {
                char: 'ä»–', 
                pinyin: 'tÄ',
                options: ['tÄ', 'shÄ“ng', 'guÃ³', 'niÃ¡n']
            },
            {
                char: 'å¥½', 
                pinyin: 'hÇo',
                options: ['hÇo', 'jiÃ¹', 'nÃ ', 'hÃ©']
            }
        ];
        
        async function initTest() {
            const statusEl = document.getElementById('status');
            
            try {
                statusEl.innerHTML = 'ğŸ”„ æ­£åœ¨åˆå§‹åŒ–è¯­éŸ³ç³»ç»Ÿ...';
                
                speechSystem = new SpeechSystem();
                await speechSystem.init();
                
                const status = speechSystem.getStatus();
                
                if (status.isSupported && status.isEnabled) {
                    statusEl.innerHTML = `âœ… è¯­éŸ³ç³»ç»Ÿå°±ç»ªï¼å½“å‰è¯­éŸ³: ${status.currentVoice}`;
                    loadQuestion();
                } else {
                    statusEl.innerHTML = 'âŒ è¯­éŸ³ç³»ç»Ÿä¸å¯ç”¨';
                }
            } catch (error) {
                statusEl.innerHTML = `âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`;
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }
        
        function loadQuestion() {
            const question = testQuestions[currentIndex];
            currentChar = { char: question.char, pinyin: question.pinyin };
            correctPinyin = question.pinyin;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('character-text').textContent = question.char;
            document.getElementById('character-info').textContent = `æ­£ç¡®æ‹¼éŸ³: ${question.pinyin}`;
            document.getElementById('feedback').textContent = 'ç‚¹å‡»ä»»æ„æ‹¼éŸ³é€‰é¡¹æµ‹è¯•å‘éŸ³';
            document.getElementById('feedback').style.color = 'white';
            
            // æ›´æ–°é€‰é¡¹
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach((btn, index) => {
                if (index < question.options.length) {
                    btn.textContent = question.options[index];
                    btn.dataset.pinyin = question.options[index];
                    btn.disabled = false;
                    btn.classList.remove('correct-option', 'wrong-option', 'playing');
                    btn.onclick = () => handleOptionClick(btn);
                    btn.style.display = 'block';
                } else {
                    btn.style.display = 'none';
                }
            });
        }
        
        async function handleOptionClick(button) {
            const clickedPinyin = button.dataset.pinyin;
            
            // æ£€æŸ¥è¯­éŸ³ç³»ç»Ÿæ’­æ”¾çŠ¶æ€
            if (speechSystem && speechSystem.isPlaying) {
                console.log('â¸ï¸ è¯­éŸ³æ­£åœ¨æ’­æ”¾ä¸­ï¼Œè·³è¿‡æ–°çš„æ’­æ”¾è¯·æ±‚');
                return;
            }
            
            // æ’­æ”¾æ‹¼éŸ³å‘éŸ³
            if (clickedPinyin && speechSystem) {
                button.classList.add('playing');
                
                try {
                    await speechSystem.speakPinyin(clickedPinyin);
                    document.getElementById('feedback').innerHTML = `ğŸ”Š æ’­æ”¾å®Œæˆ: ${clickedPinyin}`;
                } catch (error) {
                    console.error('æ’­æ”¾å¤±è´¥:', error);
                    document.getElementById('feedback').innerHTML = `âŒ æ’­æ”¾å¤±è´¥: ${clickedPinyin}`;
                }
                
                setTimeout(() => {
                    button.classList.remove('playing');
                }, 600);
            }
            
            // æ˜¾ç¤ºæ˜¯å¦ä¸ºæ­£ç¡®ç­”æ¡ˆ
            setTimeout(() => {
                if (clickedPinyin === correctPinyin) {
                    button.classList.add('correct-option');
                    document.getElementById('feedback').innerHTML = `âœ… æ­£ç¡®ç­”æ¡ˆ: ${clickedPinyin}`;
                    document.getElementById('feedback').style.color = '#4CAF50';
                } else {
                    button.classList.add('wrong-option');
                    document.getElementById('feedback').innerHTML = `âŒ é”™è¯¯é€‰é¡¹: ${clickedPinyin}ï¼ˆä½†å‘éŸ³åº”è¯¥æ­£ç¡®ï¼‰`;
                    document.getElementById('feedback').style.color = '#f44336';
                }
            }, 400);
        }
        
        function nextQuestion() {
            currentIndex = (currentIndex + 1) % testQuestions.length;
            loadQuestion();
        }
        
        async function testAllOptions() {
            if (!speechSystem) {
                document.getElementById('status').innerHTML = 'âŒ è¯·å…ˆåˆå§‹åŒ–è¯­éŸ³ç³»ç»Ÿ';
                return;
            }
            
            const buttons = document.querySelectorAll('.option-btn:not([style*="none"])');
            const statusEl = document.getElementById('status');
            
            statusEl.innerHTML = 'ğŸµ æ­£åœ¨æµ‹è¯•æ‰€æœ‰é€‰é¡¹...';
            
            for (let i = 0; i < buttons.length; i++) {
                const button = buttons[i];
                const pinyin = button.dataset.pinyin;
                
                if (pinyin) {
                    button.classList.add('playing');
                    statusEl.innerHTML = `ğŸµ æµ‹è¯• ${i + 1}/${buttons.length}: ${pinyin}`;
                    
                    try {
                        await speechSystem.speakPinyin(pinyin);
                        await new Promise(resolve => setTimeout(resolve, 800));
                    } catch (error) {
                        console.error('æµ‹è¯•å¤±è´¥:', error);
                    }
                    
                    button.classList.remove('playing');
                }
            }
            
            statusEl.innerHTML = 'âœ… æ‰€æœ‰é€‰é¡¹æµ‹è¯•å®Œæˆï¼';
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(initTest, 500);
        });
    </script>
</body>
</html>
